function lt(t){return o[t>>18&63]+o[t>>12&63]+o[t>>6&63]+o[t&63]}function ot(t,n,r){var u,i=[];for(var c=n;c<r;c+=3)u=(t[c]<<16&16711680)+(t[c+1]<<8&65280)+(t[c+2]&255),i.push(lt(u));return i.join("")}function at(t){var n,r=t.length,u=r%3,i=[],c=16383;for(var a=0,d=r-u;a<d;a+=c)i.push(ot(t,a,a+c>d?d:a+c));if(u===1)n=t[r-1],i.push(o[n>>2]+o[n<<4&63]+"==");else if(u===2)n=(t[r-2]<<8)+t[r-1],i.push(o[n>>10]+o[n>>4&63]+o[n<<2&63]+"=");return i.join("")}var P=at;var o=[],U=[];var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(w=0,I=K.length;w<I;++w)o[w]=K[w],U[K.charCodeAt(w)]=w;var w,I;U["-".charCodeAt(0)]=62;U["_".charCodeAt(0)]=63;function X(t){return typeof t==="object"&&t!==null&&!Array.isArray(t)}function M(t=0.5){return Math.random()<t}function q(t,n){return t+Math.floor(Math.random()*(n-t))}function D(t){return t[q(0,t.length)]}function S(){if(j===void 0){const t=Math.sqrt(-2*Math.log(Math.random())),n=2*Math.PI*Math.random();return j=t*Math.sin(n),t*Math.cos(n)}else{const t=j;return j=void 0,t}}function h(t=1){const n=Math.exp(-t);let r=0,u=Math.random();while(u>n)r++,u*=Math.random();return r}function A(t){return Array(t).fill(null).map(()=>Y.charAt(Math.floor(Math.random()*Y.length))).join("")}function*e(...t){for(let n of t)yield*n}function*O(t,n){let r=0;for(let u of t)yield n(u,r++)}function*ht(t,n){let r=0;for(let u of t)if(n(u,r++))yield u}function*mt(t){for(let n=0;n<t;++n)yield n}function _(){return new V}function F(){return new b("float64")}function l(){return new R}function C(...t){const n=new Set(t);if(n.size!==t.length)throw new Error("enum can't contain duplicates");else return new y(t,n)}function Z(t){if(t.definitions)throw new Error("definitions can only exist on a root schema");else return new k(t)}function N(t){if(t.definitions)throw new Error("definitions can only exist on a root schema");else return new L(t)}function m(t,n,r){return zt(t?Object.entries(t):void 0,n?Object.entries(n):void 0,r)}function B(t,n){return ft(t,n,Object.entries(n))}var wt={int8:[-128,128],int16:[-32768,32768],int32:[-2147483648,2147483648],uint8:[0,256],uint16:[0,65536],uint32:[0,4294967296]},j,Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ;,'\"",zt=function(t,n,r){const u=new Set(O(e(t??[],n??[]),([i])=>i));if(t?.some(([,i])=>i.definitions))throw new Error("definitions can only exist on a root schema");else if(n?.some(([,i])=>i.definitions))throw new Error("definitions can only exist on a root schema");else if(u.size!==(t?.length??0)+(n?.length??0))throw new Error("properties and optionalProperties keys must be unique");else return new H(t,n,r??!1,u)},ft=function(t,n,r){if(r.some(([,u])=>u.definitions))throw new Error("definitions can only exist on a root schema");else if(r.some(([,u])=>u.keys?.has(t)??!0))throw new Error("all discriminator mappings must be properties schemas that don't contain discriminator");else return new p(t,n,r)};class dt{#t;definitions;nullable=!0;constructor(t){this.#t=t,this.definitions=t.definitions}guard(t){return t===null||this.#t.guard(t)}fuzz(){return M(0.1)?null:this.#t.fuzz()}schema(){return{...this.#t.schema(),nullable:!0}}}class jt{#t;#n;definitions;nullable;constructor(t,n){this.#t=t,this.#n=n,this.definitions=t.definitions,this.nullable=t.nullable}guard(t){return this.#t.guard(t)}fuzz(){return this.#t.fuzz()}schema(){return{...this.#t.schema(),metadata:this.#n}}}class V{guard(t){return typeof t==="boolean"}fuzz(){return M()}schema(){return{type:"boolean"}}}class Ot{#t;#n;#r;constructor(t){this.#t=t,[this.#n,this.#r]=wt[t]}guard(t){return typeof t==="number"&&t%1===0&&this.#n<=t&&t<this.#r}fuzz(){return q(this.#n,this.#r)}schema(){return{type:this.#t}}}class b{#t;constructor(t){this.#t=t}guard(t){return typeof t==="number"}fuzz(){return S()}schema(){return{type:this.#t}}}class R{guard(t){return typeof t==="string"}fuzz(){return A(h(3))}schema(){return{type:"string"}}}class y{#t;#n;constructor(t,n){this.#t=t,this.#n=n}guard(t){return typeof t==="string"&&this.#n.has(t)}fuzz(){return D(this.#t)}schema(){return{enum:[...this.#t]}}}class k{#t;constructor(t){this.#t=t}guard(t){return Array.isArray(t)&&t.every((n)=>this.#t.guard(n))}fuzz(){return Array(h()).fill(null).map(()=>this.#t.fuzz())}schema(){return{elements:this.#t.schema()}}}class L{#t;constructor(t){this.#t=t}guard(t){return X(t)&&Object.values(t).every((n)=>this.#t.guard(n))}fuzz(){return Object.fromEntries(Array(h()).fill(null).map(()=>[A(h(3)),this.#t.fuzz()]))}schema(){return{values:this.#t.schema()}}}class H{#t;#n;#r;keys;constructor(t,n,r,u){this.#t=t,this.#n=n,this.#r=r,this.keys=u}guard(t){return X(t)&&(this.#t?.every(([n,r])=>r.guard(t[n]))??!0)&&(this.#n?.every(([n,r])=>t[n]===void 0||r.guard(t[n]))??!0)&&(this.#r||Object.keys(t).every((n)=>this.keys.has(n)))}fuzz(){const t=O(this.#t??[],([u,i])=>[u,i.fuzz()]),n=O(ht(this.#n??[],()=>M()),([u,i])=>[u,i.fuzz()]),r=this.#r?O(mt(h()),()=>[A(h(3)),D([()=>null,M,S,()=>A(h()),()=>[],()=>({})])()]):[];return Object.fromEntries(e(t,n,r))}schema(){const t={};if(this.#t)t.properties=Object.fromEntries(this.#t.map(([n,r])=>[n,r.schema()]));if(this.#n)t.optionalProperties=Object.fromEntries(this.#n.map(([n,r])=>[n,r.schema()]));if(this.#r)t.additionalProperties=!0;return t}}class p{#t;#n;#r;constructor(t,n,r){this.#t=t,this.#n=n,this.#r=r}guard(t){if(!X(t))return!1;const{[this.#t]:n,...r}=t;if(typeof n!=="string")return!1;return this.#n[n]?.guard(r)??!1}fuzz(){const[t,n]=D(this.#r);return{...n.fuzz(),[this.#t]:t}}schema(){const t=Object.fromEntries(this.#r.map(([n,r])=>[n,r.schema()]));return{discriminator:this.#t,mapping:t}}}class T{#t;#n;definitions=!0;constructor(t,n){this.#t=t,this.#n=n}guard(t){return this.#n.guard(t)}fuzz(){return this.#n.fuzz()}schema(){const t=Object.fromEntries(Object.entries(this.#t).map(([n,r])=>[n,r.schema()]));return{...this.#n.schema(),definitions:t}}}class v{#t;#n;constructor(t,n){this.#t=t,this.#n=n}guard(t){return this.#n.guard(t)}fuzz(){return this.#n.fuzz()}schema(){return{ref:this.#t}}}class tt{#t;#n;constructor(t,n){this.#t=t,this.#n=n}def(t,n){const r=n(this.#n);return new tt({...this.#t,[t]:r},{...this.#n,[t]:new v(t,r)})}build(t){return new T(this.#t,t(this.#n))}}class Mt{#t;#n;constructor(t,n){this.#n=t,this.#t=n}guard(t){return this.#n[this.#t].guard(t)}fuzz(){return this.#n[this.#t].fuzz()}schema(){return{ref:this.#t}}}function nt(t,n=0){return(s[t[n+0]]+s[t[n+1]]+s[t[n+2]]+s[t[n+3]]+"-"+s[t[n+4]]+s[t[n+5]]+"-"+s[t[n+6]]+s[t[n+7]]+"-"+s[t[n+8]]+s[t[n+9]]+"-"+s[t[n+10]]+s[t[n+11]]+s[t[n+12]]+s[t[n+13]]+s[t[n+14]]+s[t[n+15]]).toLowerCase()}var s=[];for(E=0;E<256;++E)s.push((E+256).toString(16).slice(1));var E;var J,At=new Uint8Array(16);function $(){if(!J){if(J=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!J)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}return J(At)}var Et=typeof crypto!=="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),G={randomUUID:Et};function Jt(t,n,r){if(G.randomUUID&&!n&&!t)return G.randomUUID();t=t||{};var u=t.random||(t.rng||$)();if(u[6]=u[6]&15|64,u[8]=u[8]&63|128,n){r=r||0;for(var i=0;i<16;++i)n[r+i]=u[i];return n}return nt(u)}var W=Jt;function x(t,n,r){if(!r||n.guard(t))return t;else throw new Error(`couldn't validate schema: ${JSON.stringify(t)} didn't match schema ${JSON.stringify(n.schema())}`)}async function Bt(t,{deviceDesc:n="browser-chrome",uuid:r=W(),authHost:u=it,fetch:i=globalThis.fetch}={}){if(t.length!==8)throw new Error(`code should be length 8, but was ${t.length}`);const c=await i(`${u}/token/json/2/device/new`,{method:"POST",headers:{Authorization:"Bearer"},body:JSON.stringify({code:t,deviceDesc:n,deviceID:r})});if(!c.ok)throw new g(c.status,c.statusText,"couldn't register api");else return await c.text()}async function Vt(t,{fetch:n=globalThis.fetch,authHost:r=it,syncHost:u=Qt}={}){const i=await n(`${r}/token/json/2/user/new`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error(`couldn't fetch auth token: ${i.statusText}`);const c=await i.text();return new ct(c,n,u)}var it="https://webapp-prod.cloud.remarkable.engineering",Qt="https://web.eu.tectonic.remarkable.com",z=/^([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}||trash)$/,Q=/^[0-9a-f]{64}$/,rt={id:l(),hash:l(),visibleName:l(),lastModified:l(),pinned:_()},ut={parent:l(),tags:Z(m({name:l(),timestamp:F()}))},xt=B("type",{CollectionType:m(rt,ut,!0),DocumentType:m({...rt,lastOpened:l(),fileType:C("epub","pdf","notebook")},ut,!0)}),Kt=Z(xt),Ut=m({docID:l(),hash:l()}),Pt=m({hash:l()}),Xt=m({hashes:N(l())});class g extends Error{status;statusText;constructor(t,n,r){super(r);this.status=t,this.statusText=n}}class f extends Error{field;regex;constructor(t,n,r){super(r);this.field=t,this.regex=n}}class ct{#t;#n;#r;constructor(t,n,r){this.#t=t,this.#n=n,this.#r=r}async#s(t,{body:n,method:r="POST",headers:u={}}){const i=await this.#n(t,{method:r,headers:{Authorization:`Bearer ${this.#t}`,...u},body:n});if(!i.ok){const c=await i.text();throw new g(i.status,i.statusText,`failed reMarkable request: ${c}`)}else return i}async#u({meta:t="",method:n="GET",contentType:r="text/plain;charset=UTF-8",body:u,hash:i}={}){const a=new TextEncoder().encode(t),d=i===void 0?"":`/${i}`,st=await(await this.#s(`${this.#r}/doc/v2/files${d}`,{body:u,method:n,headers:{"content-type":r,"rm-meta":P(a),"rm-source":"WebLibrary"}})).text();return JSON.parse(st)}async listFiles({verify:t=!0}={}){const n=await this.#u();return x(n,Kt,t)}async#i(t,n,r,u,i){if(i&&!z.test(t))throw new f(t,z,"parent must be a valid document id");const c=await this.#u({meta:JSON.stringify({parent:t,file_name:n}),method:"POST",contentType:u,body:r});return x(c,Ut,i)}async createFolder(t,{parent:n="",verify:r=!0}={}){return await this.#i(n,t,new ArrayBuffer(0),"folder",r)}async uploadEpub(t,n,{parent:r="",verify:u=!0}={}){return await this.#i(r,t,n,"application/epub+zip",u)}async uploadPdf(t,n,{parent:r="",verify:u=!0}={}){return await this.#i(r,t,n,"application/pdf",u)}async#c(t,n,r){if(r&&!Q.test(t))throw new f(t,Q,"hash to modify was not a valid hash");const u=await this.#u({hash:t,body:JSON.stringify(n),method:"PATCH"});return x(u,Pt,r)}async move(t,n,{verify:r=!0}={}){if(r&&!z.test(n))throw new f(n,z,"parent must be a valid document id");return await this.#c(t,{parent:n},r)}async delete(t,n={}){return await this.move(t,"trash",n)}async rename(t,n,{verify:r=!0}={}){return await this.#c(t,{file_name:n},r)}async#l(t,n,r){if(r){if(t.filter((c)=>!Q.test(c)).length)throw new f(t.join(", "),Q,"hashes to modify were not a valid hashes")}const u=await this.#u({body:JSON.stringify({updates:n,hashes:t}),method:"PATCH"});return x(u,Xt,r)}async bulkMove(t,n,{verify:r=!0}={}){if(r&&!z.test(n))throw new f(n,z,"parent must be a valid document id");return await this.#l(t,{parent:n},r)}async bulkDelete(t,n={}){return await this.bulkMove(t,"trash",n)}}export{Vt as remarkable,Bt as register,f as ValidationError,g as ResponseError};
